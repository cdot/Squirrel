/*@preserve Copyright (C) 2015 Crawford Currie http://c-dot.co.uk license MIT*/
function DropboxStore(o){"use strict";var t=this;new Dropbox.Client({key:APP_KEY}).authenticate(function(e,r){e?(global.DEBUG&&console.debug("Dropbox auth failed: "+e),o.fail(t,e.responseText)):(global.DEBUG&&console.debug("Dropbox auth OK"),r.getAccountInfo(null,function(a,l){if(a){var n=a.responseText||"Status: "+e.status;global.DEBUG&&console.debug("Dropbox getAccountInfo failed "+n),o.fail.call(t,n)}else global.DEBUG&&console.debug("Dropbox username "+l.name),t.db_client=r,t.user(l.name),AbstractStore.call(t,o)}))})}const APP_KEY="37tzcd7ezkaqovy";global.CLOUD_STORE=DropboxStore,DropboxStore.prototype=Object.create(AbstractStore.prototype),DropboxStore.prototype.options=function(){"use strict";return $.extend(AbstractStore.prototype.options(),{needs_path:!0,identifier:"Dropbox"})},DropboxStore.prototype.write=function(o,t,e,r){"use strict";var a=this;this.db_client.writeFile(o,t,function(o){o?(global.DEBUG&&console.debug("Dropbox write failed "+o.responseText),r.call(a,o.responseText||o.status)):e.call(a,a.data)})},DropboxStore.prototype.read=function(o,t,e){"use strict";var r=this;this.db_client.readFile(o,{arrayBuffer:!0},function(o,a){o?(global.DEBUG&&console.debug("Dropbox read failed "+o.responseText),o.status===Dropbox.ApiError.NOT_FOUND?e.call(r,AbstractStore.NODATA):e.call(r,o.responseText)):t.call(r,a)})};