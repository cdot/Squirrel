/*@preserve Copyright (C) 2015 Crawford Currie http://c-dot.co.uk license MIT*/
function EncryptedStore(e){"use strict";LayeredStore.call(this,e)}if("undefined"!=typeof module)var LayeredStore=require("./LayeredStore");EncryptedStore.prototype=Object.create(LayeredStore.prototype),EncryptedStore.prototype.options=function(){"use strict";return $.extend(LayeredStore.prototype.options.call(this),{needs_pass:!0})},EncryptedStore.prototype.read=function(e,t,r){"use strict";var o=this;global.DEBUG&&console.debug("EncryptedStore: reading "+e+" with password "+o.engine.pass()),this.engine.read(e,function(e){var n;try{global.DEBUG&&console.debug("EncryptedStore: decrypting using password "+o.engine.pass()),n=AES.decrypt(e,o.engine.pass(),256)}catch(e){return global.DEBUG&&console.debug("Caught "+e),void r.call(o,e)}t.call(o,n)},r)},EncryptedStore.prototype.write=function(e,t,r,o){"use strict";var n=this;global.DEBUG&&console.debug("EncryptedStore: writing "+e+" with password "+n.engine.pass());var s;try{s=AES.encrypt(t,this.engine.pass(),256)}catch(e){return global.DEBUG&&console.debug("Caught "+e),void o.call(this,e)}this.engine.write(e,s.buffer,function(){r.call(n)},o)},"undefined"!=typeof module&&(module.exports=EncryptedStore);