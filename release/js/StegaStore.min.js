/*@preserve Copyright (C) 2015 Crawford Currie http://c-dot.co.uk license MIT*/
function StegaStore(t){"use strict";LayeredStore.call(this,t)}StegaStore.prototype=Object.create(LayeredStore.prototype),StegaStore.prototype.options=function(){"use strict";return $.extend(LayeredStore.prototype.options.call(this),{needs_image:!0})},StegaStore.prototype.read=function(t,e,a){"use strict";global.DEBUG&&console.debug("StegaStore: reading "+t);var o=this,r=function(){var t,r=new Steganographer($("#stegamage")[0]);try{t=r.extract()}catch(t){return global.DEBUG&&console.debug("Caught "+t),void a.call(o,t)}e.call(o,t)};this.engine.read(t,function(t){var e="data:image/png;base64,"+Utils.ArrayBufferToBase64(t);e!==$("#stegamage").attr("src")?$("#stegamage").attr("src",e).on("load",function(){$(this).off("load"),r()}):r()},a)},StegaStore.prototype.write=function(t,e,a,o){"use strict";global.DEBUG&&console.debug("StegaStore: writing "+t);var r=this,n=document.getElementById("stegamage");if(!n)throw"no #stegamage";var g,i=new Steganographer(n);try{var s=i.inject(e,!0),c=s.toDataURL(),l=c.split(",",2)[1];g=Utils.Base64ToArrayBuffer(l)}catch(t){return global.DEBUG&&console.debug("Caught "+t),void o.call(this,t)}r.engine.write(t,g,function(){a.call(r)},o)};