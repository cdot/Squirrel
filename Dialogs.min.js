Squirrel.Dialog={},Squirrel.Dialog.play_action=function(action){"use strict";var res=Squirrel.client.hoard.record_action(action,function(e){Squirrel.Tree.action(e,function(){Utils.sometime("update_save")},!0)});null!==res&&Squirrel.Dialog.squeak(res.message)},Squirrel.Dialog.squeak=function(e,ok,cancel){"use strict";var $dlg=$("#dlg_alert");"string"==typeof e?$("#dlg_alert_message").html(e):$("#dlg_alert_message").empty().append(e);var called_back=!1;"undefined"==typeof $dlg.dialog("instance")&&($("#dlg_alert_ok").button().on("click",function(){return"undefined"!=typeof ok&&(ok(),called_back=!0),$dlg.dialog("close"),!1}),$("#dlg_alert_cancel").button().on("click",function(){return"undefined"!=typeof cancel&&(cancel(),called_back=!0),$dlg.dialog("close"),!1})),$("#dlg_alert_ok").toggle("undefined"!=typeof ok),$("#dlg_alert_cancel").toggle("undefined"!=typeof cancel),$dlg.dialog({modal:!0,close:function(){called_back||("undefined"!=typeof cancel?cancel():"undefined"!=typeof ok&&ok())}})},Squirrel.Dialog.confirm_delete=function($node){"use strict";var $dlg=$("#dlg_delconf"),p=Squirrel.Tree.path($node);$dlg.data("path",p),$("#dlg_delconf_message").text(p.join("/")),$("#dlg_delconf_coll").toggle($node.hasClass("treecollection")),"undefined"==typeof $dlg.dialog("instance")&&($("#dlg_delconf_delete").button().on("click",function(){var $ddlg=$("#dlg_delconf");$ddlg.dialog("close");var res=Squirrel.client.hoard.record_action({type:"D",path:$ddlg.data("path")},function(e){Squirrel.Tree.action(e,function(){Utils.sometime("update_save"),Utils.sometime("update_tree")},!0)});return null!==res&&Squirrel.Dialog.squeak(res.message),!1}),$("#dlg_delconf_cancel").button().on("click",function(){return $("#dlg_delconf").dialog("close"),!1})),$dlg.dialog({modal:!0,width:"auto"})},Squirrel.Dialog.make_random=function($node){"use strict";var $dlg=$("#dlg_gen_rand"),opts={length:$("#dlg_gen_rand_len").val(),charset:$("#dlg_gen_rand_chs").val()};$("#dlg_gen_rand_key").text($node.children(".node_div").children(".key").text()),$("#dlg_gen_rand_idea").text(Utils.generate_password(opts)),$dlg.data("node",$node),$dlg.data("opts",opts),"undefined"==typeof $dlg.dialog("instance")&&($("#dlg_gen_rand_use").button().on("click",function(){var $ddlg=$("#dlg_gen_rand");$ddlg.dialog("close");var pw=$("#dlg_gen_rand_idea").text(),old_path=Squirrel.Tree.path($ddlg.data("node"));return Squirrel.Dialog.play_action({type:"E",path:old_path,data:pw}),!1}),$("#dlg_gen_rand_again").button().on("click",function(){var $ddlg=$("#dlg_gen_rand");return opts=$ddlg.data("opts"),opts.length=$("#dlg_gen_rand_len").val(),opts.charset=$("#dlg_gen_rand_chs").val(),$("#dlg_gen_rand_idea").text(Utils.generate_password(opts)),!1}),$("#dlg_gen_rand_cancel").button().on("click",function(){return $("#dlg_gen_rand").dialog("close"),!1})),$dlg.dialog({width:"auto",modal:!0})},Squirrel.Dialog.change_password=function(){"use strict";var $dlg=$("#dlg_chpw");"undefined"==typeof $dlg.dialog("instance")&&($("#dlg_chpw_show").on("change",function(){$("#dlg_chpw_show").prop("checked")?($("#dlg_chpw_pass").attr("type","text"),$("#dlg_chpw_conf").attr("type","text")):($("#dlg_chpw_pass").attr("type","password"),$("#dlg_chpw_conf").attr("type","password"))}),$("#dlg_chpw_set").button().on("click",function(){var p=$("#dlg_chpw_pass").val(),c=$("#dlg_chpw_conf").val();return p!==c?Squirrel.Dialog.squeak("Passwords do not match"):(Squirrel.client.store.pass(p),Squirrel.client.status=Squirrel.NEW_SETTINGS,Squirrel.cloud.store.pass(p),Squirrel.cloud.status=Squirrel.NEW_SETTINGS,$("#dlg_chpw").dialog("close"),Utils.sometime("update_save")),!1})),$dlg.dialog({modal:!0,width:"auto"})},Squirrel.Dialog.login=function(store,ok,fail,uReq,pReq){"use strict";var $dlg=$("#dlg_login");$("#dlg_login_uReq").toggle(uReq),$("#dlg_login_pReq").toggle(pReq);var $user=$("#dlg_login_user"),$pass=$("#dlg_login_pass"),$signin=$("#dlg_login_signin");$user.val(store.user()),$pass.val(store.pass()),uReq?($user.attr("autofocus","autofocus"),$user.on("change",function(){(pReq?$pass:$signin).focus()})):pReq&&($("#dlg_login_foruser").toggle(null!==store.user()).text(store.user()||""),$pass.attr("autofocus","autofocus")),$pass.on("change",function(){$signin.focus()}),$signin.button().on("click",function(){return $dlg.dialog("close"),ok.call(store,$user.val(),$pass.val()),!1}),$dlg.dialog({modal:!0,width:"auto",closeOnEscape:!1,open:function(){$dlg.parent().find(".ui-dialog-titlebar-close").hide()}})};const units_days={d:1,w:7,m:30,y:365},ms_in_day=864e5;Squirrel.Dialog.alarm=function($node){"use strict";var $dlg=$("#dlg_alarm"),$alarm=$node.children(".alarm"),path=Squirrel.Tree.path($node),number=6,units="m",is_new="undefined"==typeof $dlg.dialog("instance"),update_next=function(){var numb=$("#dlg_alarm_number").val()*units_days[$("#dlg_alarm_units").val()],elapsed=Math.round((Date.now()-$node.data("last-time"))/ms_in_day);numb>elapsed&&(numb-=elapsed);var uns="d";numb%units_days.y===0?(numb/=units_days.y,uns="y"):numb%units_days.m===0?(numb/=units_days.m,uns="m"):numb%units_days.w===0&&(numb/=units_days.w,uns="w"),$("#dlg_alarm_next").text(numb),$(".dlg_alarm_next").hide(),$(".dlg_alarm_next."+uns).show()};$alarm.length>0&&(number=$alarm.data("alarm"),number%units_days.y===0?(number/=units_days.y,units="y"):number%units_days.m===0?(number/=units_days.m,units="m"):number%units_days.w===0?(number/=units_days.w,units="w"):units="d"),$dlg.data("path",path),$("#dlg_alarm_number").val(number),$("#dlg_alarm_units").val(units),update_next(),$dlg.dialog({modal:!0,width:"auto"}),is_new&&($("#dlg_alarm_units").selectmenu().on("change",update_next),$("#dlg_alarm_number").spinner({min:1}).on("change",update_next),$("#dlg_alarm_set").button().on("click",function(){$dlg.dialog("close");var numb=$("#dlg_alarm_number").val()*units_days[$("#dlg_alarm_units").val()];return Squirrel.Dialog.play_action({type:"A",path:$dlg.data("path"),data:numb}),!1}),$("#dlg_alarm_cancel").button().on("click",function(){return $dlg.dialog("close"),$alarm&&Squirrel.Dialog.play_action({type:"C",path:$dlg.data("path")}),!1}),$dlg.parent().css("overflow","visible"))},Squirrel.Dialog.pick_from=function($node){"use strict";var i,$f,$dlg=$("#dlg_pick"),val=$node.children(".node_div").children(".value").text(),$which=$("#dlg_pick_which"),$from=$("#dlg_pick_from"),item_clicked=function(){var ii=$(this).data("i");$dlg.find("td.i"+ii).addClass("picked")};for("undefined"==typeof $dlg.dialog("instance")&&$("#dlg_pick_clear").button().on("click",function(){$dlg.find(".picked").removeClass("picked")}),i=0;i<val.length;i++)$f=$from.children("td.i"+i),0===$f.length&&($("<td></td>").data("i",i).addClass("pick_cell i"+i).text(i+1).on("click",item_clicked).appendTo($which),$f=$("<td></td>").data("i",i).addClass("pick_cell i"+i).on("click",item_clicked).appendTo($from)),$f.text(val.charAt(i));for(;i<$from.children("td").length;)$from.children("td").last().remove(),i++;$dlg.find(".picked").removeClass("picked"),$dlg.dialog({modal:!0,width:"auto"})},Squirrel.Dialog.ss_change_image=function(){"use strict";var fail=function(e){$("#dlg_ss_message").text(TX.tx("Cannot use this image because of this error: $1",e))};$("#dlg_ss_ok").attr("disabled",!0);var file=$(this)[0].files[0];Utils.read_file(file,function(data){data="data:"+file.type+";base64,"+Utils.ArrayBufferToBase64(data),data!==$("#stegamage").attr("src",data)&&$("#stegamage").attr("src",data).on("load",function(){$(this).off("load");var steg=new Steganographer(this);try{steg.inject("tada")}catch(e){return void fail(e)}$("#dlg_ss_ok").attr("disabled",!1);var h=this.naturalHeight,w=this.naturalWidth;this.height=100,$("#dlg_ss_message").html("<br>"+w+" x "+h),Squirrel.client.status===Squirrel.IS_LOADED&&(Squirrel.client.status=Squirrel.NEW_SETTINGS),Squirrel.cloud.status===Squirrel.IS_LOADED&&(Squirrel.cloud.status=Squirrel.NEW_SETTINGS),Utils.sometime("update_save")})},fail,"arraybuffer")},Squirrel.Dialog.store_settings=function(ok){"use strict";var $dlg=$("#dlg_ss");"undefined"==typeof $dlg.dialog("instance")&&($("#dlg_ss_file").hide().on("change",Squirrel.Dialog.ss_change_image),$("#dlg_ss_choose").button().click(function(e){$("#dlg_ss_file").trigger("click",e)}),$("#dlg_ss_ok").button().on("click",function(){return""===$("#dlg_ss_storepath").val()?($("#dlg_ss_message").text(TX.tx("Store path may not be empty")),!1):($dlg.dialog("close"),Squirrel.client.hoard.options.store_path!==$("#dlg_ss_storepath").val()&&(Squirrel.client.hoard.options.store_path=$("#dlg_ss_storepath").val(),Squirrel.client.status===Squirrel.IS_LOADED&&(Squirrel.client.status=Squirrel.NEW_SETTINGS),Squirrel.cloud.status===Squirrel.IS_LOADED&&(Squirrel.cloud.status=Squirrel.NEW_SETTINGS)),ok&&ok(),!1)})),$("#dlg_ss_storepath").val(Squirrel.client.hoard.options.store_path),$("#dlg_ss_message").empty(),$dlg.dialog({modal:!0,width:"auto"})};
//# sourceMappingURL=Dialogs.map