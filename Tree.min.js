Squirrel.Tree={cache:{},undos:[]},Squirrel.Tree.set_root=function($node){"use strict";Squirrel.Tree.cache[""]=$node},Squirrel.Tree.set_modified=function($node,time){"use strict";var d=new Date(time);$node.addClass("modified").data("last-time",time).data("last-mod",d.toLocaleString())},Squirrel.Tree.path=function($node){"use strict";$node.hasClass("node")||($node=$node.closest(".node"));var path,ps=$node.data("path");return"undefined"!=typeof ps&&null!==ps?ps.split(Squirrel.PATHSEP):("undefined"!=typeof $node.data("key")?(path=Squirrel.Tree.path($node.parent().closest(".node")),path.push($node.data("key")),ps=path.join(Squirrel.PATHSEP),$node.data("path",ps),Squirrel.Tree.cache[ps]=$node):path=[],path)},Squirrel.Tree.node=function(path){"use strict";var $node=Squirrel.Tree.cache[path.join(Squirrel.PATHSEP)];return $node},Squirrel.Tree.compare=function(a,b){"use strict";return a=a.toLowerCase(),b=b.toLowerCase(),"user"===a?"user"===b?0:-1:"user"===b?1:"pass"===a?"pass"===b?0:-1:"pass"===b?1:a===b?0:b>a?-1:1},Squirrel.Tree.action_N=function(action,undoable){"use strict";var parent=action.path.slice(),key=parent.pop(),$container=Squirrel.Tree.node(parent).children("ul"),$node=$("<li class='node'></li>").data("key",key),$div=$("<div class='node_div'></div>").appendTo($node);$("<span class='key'></span>").text(key).appendTo($div),"undefined"!=typeof action.data&&null!==action.data?($div.addClass("treeleaf"),$("<span class='kv_separator'> : </span>").appendTo($div),$("<span class='value'></span>").text(action.data).appendTo($div)):($div.addClass("treecollection"),$("<ul></ul>").appendTo($node));var inserted=!1;$container.children("li.node").each(function(){return Squirrel.Tree.compare($(this).data("key"),key)>0?($node.insertBefore($(this)),inserted=!0,!1):void 0}),inserted||$container.append($node);var p=Squirrel.Tree.path($node);return undoable&&Squirrel.Tree.undos.push({type:"D",path:p}),Squirrel.Tree.set_modified($node,action.time),Squirrel.attach_node_handlers($node),$node},Squirrel.Tree.action_R=function(action,undoable){"use strict";var $node=Squirrel.Tree.node(action.path),key=action.path[action.path.length-1],$container=$node.closest("ul");Squirrel.Tree.demap($node),$node.detach().data("key",action.data).children(".node_div").children("span.key").text(action.data);var inserted=!1;$container.children("li.node").each(function(){return Squirrel.Tree.compare($(this).data("key"),action.data)>0?($node.insertBefore($(this)),inserted=!0,!1):void 0}),inserted||$container.append($node),$node.find(".node").each(function(){Squirrel.Tree.path($(this))});var p=Squirrel.Tree.path($node);return $node.scroll_into_view(),Squirrel.Tree.set_modified($node,action.time),undoable&&Squirrel.Tree.undos.push({type:"R",path:p,data:key}),$node},Squirrel.Tree.action_E=function(action,undoable){"use strict";var $node=Squirrel.Tree.node(action.path);undoable&&Squirrel.Tree.undos.push({type:"E",path:action.path.slice(),data:$node.children(".node_div").children("span.value").text()}),$node.children(".node_div").children("span.value").text(action.data),Squirrel.Tree.set_modified($node,action.time)},Squirrel.Tree.action_D=function(action,undoable){"use strict";var $node=Squirrel.Tree.node(action.path);Squirrel.Tree.demap($node),undoable&&Squirrel.Tree.undos.push({type:"N",path:action.path.slice(),data:$node.children(".node_div").children("span.value").text()});var $parent=$node.parent().closest(".node");return Squirrel.Tree.set_modified($parent,action.time),$node.remove(),$parent},Squirrel.Tree.action_A=function(action,undoable){"use strict";var $node=Squirrel.Tree.node(action.path),$alarm=$node.children(".alarm");return $alarm.length>0?$alarm.data("alarm")!==action.data&&(undoable&&Squirrel.Tree.undos.push({type:"A",path:action.path.slice(),data:$alarm.data("alarm")}),Squirrel.Tree.set_modified($node,action.time),$alarm.data("alarm",action.data)):(Squirrel.Tree.set_modified($node,action.time),$("<button></button>").addClass("alarm").data("alarm",action.data).button({icons:{primary:"squirrel-icon-alarm"},text:!1}).prependTo($node),undoable&&Squirrel.Tree.undos.push({type:"C",path:action.path.slice()}),Squirrel.attach_alarm_handlers($node)),$node},Squirrel.Tree.action_C=function(action,undoable){"use strict";var $node=Squirrel.Tree.node(action.path),$alarm=$node.children(".alarm");return $alarm.length>0&&(undoable&&Squirrel.Tree.undos.push({type:"A",path:action.path.slice(),data:$alarm.data("alarm")}),$alarm.remove(),Squirrel.Tree.set_modified($node,action.time)),$node},Squirrel.Tree.action=function(action,chain,undoable){"use strict";var $node=Squirrel.Tree["action_"+action.type](action,undoable);Utils.sometime("update_save"),"undefined"!=typeof chain&&Utils.soon(function(){chain($node)})},Squirrel.Tree.demap=function($node){"use strict";$node.hasClass("node")||($node=$node.closest(".node")),delete Squirrel.Tree.cache[$node.data("path")],$node.data("path",null).find(".node").each(function(){var $s=$(this);delete Squirrel.Tree.cache[$s.data("path")],$s.data("path",null)})},Squirrel.Tree.can_undo=function(){"use strict";return 0!==Squirrel.Tree.undos.length},Squirrel.Tree.undo=function(){"use strict";var a=Squirrel.Tree.undos.pop();a.time=Date.now();var res=Squirrel.client.hoard.record_action(a,function(e){Squirrel.Tree.action(e,function(){0===Squirrel.Tree.undos.length&&$(".modified").removeClass("modified"),Utils.sometime("update_save"),Utils.sometime("update_tree")})});null!==res&&Squirrel.Dialog.squeak(res.message)};
//# sourceMappingURL=Tree.map