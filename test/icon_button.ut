/*@preserve Copyright (C) 2019 Crawford Currie http://c-dot.co.uk license MIT*/
/*eslint-env node, mocha */
/*global document:writable*/

/**
 * Note this may not run correctly under node.js, due to the lack of event
 * handlers in jsdom. The gold standard is that it runs in a browser.
 */
requirejs = require('requirejs');

require("./TestSupport");

requirejs(["test/TestRunner", "jquery", "js/jq/icon_button"], function(TestRunner) {

  const tr = new TestRunner("icon_button");
  const assert = tr.assert;

  tr.beforeEach(function() {
    if ($("#actual").length === 0)
      $("body").append("<div id='actual'></div>");
    $("#actual").empty();
    if ($("#expected").length === 0)
      $("body").append("<div id='expected'></div>");
    $("#expected").empty();
  });

  tr.addTest('basic', function() {
    const $expected = $("#expected");
    const $actual = $("#actual");
    const $butt = $('<button data-icon="ui-icon-info">Info</button>');
    $actual.append($butt);
    $butt.icon_button();

    $("#expected").append('<button data-icon="ui-icon-info" class="ui-button ui-corner-all ui-widget ui-button-icon-only" title="Info"><span class="ui-button-icon ui-icon ui-icon-info"></span><span class="ui-button-icon-space"> </span>Info</button>');

    assert($actual.html(), $expected.html(),
           `\nExpect: ${$expected.html()}\n\nActual: ${$actual.html()}`);
  });

  tr.addTest('application', function() {
    const $expected = $("#expected");
    const $actual = $("#actual");
    const $butt = $('<button data-icon="app">App</button>');
    $actual.append($butt);
    $butt.icon_button();

    $expected.append('<button data-icon="app" class="ui-button ui-widget ui-button-icon-only" title="App"><span class="ui-button-icon squirrel-icon ui-icon app"></span><span class="ui-button-icon-space"> </span>App</button>');

    assert.equal($actual.html(), $expected.html(),
           `\nExpect: ${$expected.html()}\n\nActual: ${$actual.html()}`);    
  });

  $(() => {
    tr.run();
  });
});
