/*@preserve Copyright (C) 2015 Crawford Currie http://c-dot.co.uk license MIT*/
function StegaStore(params){"use strict";LayeredStore.call(this,params)}StegaStore.prototype=Object.create(LayeredStore.prototype),StegaStore.prototype.options=function(){"use strict";return $.extend(LayeredStore.prototype.options.call(this),{needs_image:!0})},StegaStore.prototype.read=function(path,ok,fail){"use strict";DEBUG&&console.debug("StegaStore: reading "+path);var self=this,extract=function(){var ab2,steg=new Steganographer($("#stegamage")[0]);try{ab2=steg.extract()}catch(e){return DEBUG&&console.debug("Caught "+e),void fail.call(self,e)}ok.call(self,ab2)};this.engine.read(path,function(ab){var datauri="data:image/png;base64,"+Utils.ArrayBufferToBase64(ab);datauri!==$("#stegamage").attr("src")?$("#stegamage").attr("src",datauri).on("load",function(){$(this).off("load"),extract()}):extract()},fail)},StegaStore.prototype.write=function(path,data,ok,fail){"use strict";DEBUG&&console.debug("StegaStore: writing "+path);var self=this,image=document.getElementById("stegamage");if(!image)throw"no #stegamage";var xdata,steg=new Steganographer(image);try{var canvas=steg.inject(data,!0),datauri=canvas.toDataURL(),b64=datauri.split(",",2)[1];xdata=Utils.Base64ToArrayBuffer(b64)}catch(e){return DEBUG&&console.debug("Caught "+e),void fail.call(this,e)}self.engine.write(path,xdata,function(){ok.call(self)},fail)};
//# sourceMappingURL=StegaStore.map