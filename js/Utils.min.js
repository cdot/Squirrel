/*@preserve Copyright (C) 2015 Crawford Currie http://c-dot.co.uk license MIT*/
var DEBUG=!1,Utils={waiting_for_sometime:{},sometime_timeout:!0,last_yield:Date.now(),IMMEDIATE:1,SOON:100,SOMETIME:250,MSPERDAY:864e5,TIMEUNITS:{y:{days:360,ms:314496e5,format:"$1 year$?($1!=1,s,)"},m:{days:30,ms:2592e6,format:"$1 month$?($1!=1,s,)"},d:{days:1,ms:864e5,format:"$1 day$?($1!=1,s,)"}}};Utils.setUpAjax=function(options,originalOptions,jqXHR){"use strict";if(window.FormData&&(options.dataType&&"binary"===options.dataType||options.data&&(window.ArrayBuffer&&options.data instanceof ArrayBuffer||window.Blob&&options.data instanceof Blob)))return{send:function(headers,callback){var xhr=new XMLHttpRequest,url=options.url,type=options.type,async=options.async||!0,dataType=options.responseType||"blob",data=options.data||null,username=options.username||null,password=options.password||null;xhr.addEventListener("load",function(){var data2={};data2[options.dataType]=xhr.response,callback(xhr.status,xhr.statusText,data2,xhr.getAllResponseHeaders())}),xhr.open(type,url,async,username,password);for(var i in headers)xhr.setRequestHeader(i,headers[i]);xhr.responseType=dataType,xhr.send(data)},abort:function(){jqXHR.abort()}}},"undefined"!=typeof jQuery&&jQuery.ajaxTransport("+binary",Utils.setUpAjax),Utils.generate_password=function(constraints){"use strict";var sor,eor;void 0===constraints.length&&(constraints.length=24),void 0===constraints.charset&&(constraints.charset="A-Za-z0-9");for(var cs=constraints.charset,legal=[];cs.length>0;)if(cs.length>=3&&"-"===cs.charAt(1))for(sor=cs.charCodeAt(0),eor=cs.charCodeAt(2),cs=cs.substring(3);sor<=eor;)legal.push(String.fromCharCode(sor++));else legal.push(cs.charAt(0)),cs=cs.substring(1);var array=new Uint8Array(constraints.length);window.crypto.getRandomValues(array);for(var s="",i=0;i<constraints.length;i++)s+=legal[array[i]%legal.length];return s},Utils.getURLParameters=function(){"use strict";var params={},bits=location.search.split("?",2);if(bits.length<2)return params;for(var pairs=bits[1].split(/[&;]/),i=0;i<pairs.length;i++){var pair=decodeURIComponent(pairs[i].replace(/\+/g,"%20")),kv=pair.split("=",2);params[kv[0]]=kv[1]||null}},Utils.fragmentify=function(fid){"use strict";return fid.replace(/[^A-Za-z0-9:]/g,function(m){return"_"+m.charCodeAt(0)})},Utils.sometime=function(event){"use strict";Utils.waiting_for_sometime[event]||(Utils.waiting_for_sometime[event]=!0,null===Utils.sometime_timeout&&(Utils.sometime_timeout=window.setTimeout(Utils.sometime_is_now,Utils.SOMETIME)))},Utils.sometime_is_now=function(){"use strict";Utils.sometime_timeout=null,Utils.last_yield=Date.now();for(var event in Utils.waiting_for_sometime)$(document).triggerHandler(event),delete Utils.waiting_for_sometime[event]},Utils.soon=function(fn){"use strict";Date.now()-Utils.last_yield>Utils.SOON?window.setTimeout(function(){Utils.last_yield=Date.now(),fn()},Utils.IMMEDIATE):fn()},Utils.execute_queue=function(q){"use strict";Utils.q_ready(),Utils.q_next(q)},Utils.q_ready=function(){"use strict";Utils.qready=!0},Utils.q_next=function(q){"use strict";if(q.length>0&&Utils.qready){var fn=q.shift();Utils.qready=!1,fn(Utils.q_ready)}window.setTimeout(function(){Utils.last_yield=Date.now(),Utils.q_next(q)},Utils.IMMEDIATE)},Utils.load=function(libs,uncompressed,on_loaded){"use strict";for(var _loaded=function(file){delete expect[file],0===Object.keys(expect).length&&"function"==typeof on_loaded&&on_loaded()},expect={},i=0;i<libs.length;i++)!function(file){uncompressed&&(file=file.replace(".min.",".")),expect[file]=!0,/\.js$/.test(file)?$.getScript(file).done(function(){_loaded(file)}).fail(function(jqXHR,settings,exception){}):/\.css$/.test(file)?($("link").appendTo("head").attr({type:"text/css",rel:"stylesheet"}).attr("href",file),_loaded(file)):/\.html$/.test(file)&&$.get(file).done(function(data){$(data).appendTo("body"),_loaded(file)}).fail(function(jqXHR,settings,exception){})}(libs[i])},Utils.read_file=function(file,ok,fail,mode){"use strict";var reader=new FileReader;if(reader.onload=function(){ok(reader.result)},reader.onerror=function(){fail(file.name+" read failed")},reader.onabort=reader.onerror,void 0===mode||"text"===mode)reader.readAsText(file);else if("arraybuffer"===mode)reader.readAsArrayBuffer(file);else if("binarystring"===mode)reader.readAsBinaryString(file);else{if("datauri"!==mode)throw"Unrecognised mode "+mode;reader.readAsDataURL(file)}},Utils.ArrayBufferToString=function(ab){"use strict";DEBUG&&ab.byteLength;for(var a16=new Uint16Array(ab),str="",i=0;i<a16.length;i++)str+=String.fromCharCode(a16[i]);return str},Utils.StringToArrayBuffer=function(str){"use strict";for(var a16=new Uint16Array(str.length),i=0,strLen=str.length;i<strLen;i++)a16[i]=str.charCodeAt(i);return a16.buffer},Utils.ArrayBufferToPackedString=function(ab){"use strict";for(var a8=new Uint8Array(ab),cc=0!=(1&a8.length)?256:0,high=!0,ps="",a8_len=a8.length,i=0;i<a8_len;i++)high?(ps+=String.fromCharCode(cc|a8[i]),high=!1):(cc=a8[i]<<8,high=!0);return high&&(ps+=String.fromCharCode(cc)),ps},Utils.PackedStringToArrayBuffer=function(str){"use strict";var datalen=2*str.length-1;0==(256&str.charCodeAt(0))&&datalen--;for(var high=!0,a8=new Uint8Array(datalen),i=0,j=0;j<datalen;)high?(a8[j++]|=255&str.charCodeAt(i++),high=!1):(a8[j++]=str.charCodeAt(i)>>8&255,high=!0);return a8.buffer},Utils.ArrayBufferToBase64=function(ab){"use strict";for(var a8=new Uint8Array(ab),nMod3=2,sB64Enc="",nLen=a8.length,uint6ToB64=function(nUInt6){return nUInt6<26?nUInt6+65:nUInt6<52?nUInt6+71:nUInt6<62?nUInt6-4:62===nUInt6?43:63===nUInt6?47:65},nUInt24=0,nIdx=0;nIdx<nLen;nIdx++)nMod3=nIdx%3,nUInt24|=a8[nIdx]<<(16>>>nMod3&24),2!==nMod3&&nLen-nIdx!=1||(sB64Enc+=String.fromCharCode(uint6ToB64(nUInt24>>>18&63),uint6ToB64(nUInt24>>>12&63),uint6ToB64(nUInt24>>>6&63),uint6ToB64(63&nUInt24)),nUInt24=0);return sB64Enc.substr(0,sB64Enc.length-2+nMod3)+(2===nMod3?"":1===nMod3?"=":"==")},Utils.Base64ToArrayBuffer=function(sB64){"use strict";for(var nMod3,nMod4,sB64Enc=sB64.replace(/[^A-Za-z0-9\+\/]/g,""),nInLen=sB64Enc.length,nOutLen=3*nInLen+1>>2,ta8=new Uint8Array(nOutLen),nUInt24=0,nOutIdx=0,nInIdx=0;nInIdx<nInLen;nInIdx++)if(nMod4=3&nInIdx,nUInt24|=function(nChr){return nChr>64&&nChr<91?nChr-65:nChr>96&&nChr<123?nChr-71:nChr>47&&nChr<58?nChr+4:43===nChr?62:47===nChr?63:0}(sB64Enc.charCodeAt(nInIdx))<<6*(3-nMod4),3===nMod4||nInLen-nInIdx==1){for(nMod3=0;nMod3<3&&nOutIdx<nOutLen;nMod3++,nOutIdx++)ta8[nOutIdx]=nUInt24>>>(16>>>nMod3&24)&255;nUInt24=0}return ta8.buffer},Utils.query_string=function(){"use strict";for(var query={},vars=window.location.search.substring(1).split(/[&;]+/),i=0;i<vars.length;i++)if(""!==vars[i]){var ass=vars[i].split("=");if(void 0===query[ass[0]])query[ass[0]]=decodeURIComponent(ass[1]);else if("string"==typeof query[ass[0]]){var arr=[query[ass[0]],decodeURIComponent(ass[1])];query[ass[0]]=arr}else query[ass[0]].push(decodeURIComponent(ass[1]))}return query},Utils.make_query_string=function(qs){"use strict";var params="",sep="?";for(var k in qs)params+=sep+encodeURIComponent(k)+"="+encodeURIComponent(qs[k]),sep="&";return params},Utils.deltaTimeString=function(date){"use strict";date=new Date(date.getTime()-Date.now());var s=[],delta=date.getUTCFullYear()-1970;return delta>0&&s.push(TX.tx(Utils.TIMEUNITS.y.format,delta)),date.setUTCFullYear(1970),delta=date.getUTCMonth(),delta>0&&s.push(TX.tx(Utils.TIMEUNITS.m.format,delta)),date.setUTCMonth(0),delta=date.getUTCDate(),(delta>0||0===s.length)&&s.push(TX.tx(Utils.TIMEUNITS.d.format,delta)),s.join(" ")},"undefined"!=typeof module&&(module.exports=Utils);
//# sourceMappingURL=Utils.map